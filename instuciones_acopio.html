<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wotoch - Mapa de Fundaciones</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">

  <!-- Leaflet CSS (Para el mapa) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

  <!-- Tailwind config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'hero-tittle-color': '#D67840', // Naranja del título
            'primary-brown': '#A25D53', // Café de botones y pines
            'light-brown': '#E8DDC8',
            'text-brown': '#000000',
            'teal-brand': '#0D9488',
          },
          fontFamily: {
            sans: ['Lexend'],
          }
        }
      }
    }
  </script>
  
  <style>
      /* Estilos para el mapa */
      #map {
          height: 100%;
          width: 100%;
          z-index: 1;
          border-radius: 1rem;
      }
      
      /* Personalización de los popups de Leaflet para que coincidan con el diseño */
      .leaflet-popup-content-wrapper {
          border-radius: 12px;
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
          padding: 0;
      }
      .leaflet-popup-content {
          margin: 12px;
          font-family: 'Lexend', sans-serif;
          text-align: center;
      }
      .popup-title {
          font-weight: bold;
          font-size: 1rem;
          color: #000;
          margin-bottom: 4px;
      }
      .popup-desc {
          font-size: 0.75rem;
          color: #666;
          line-height: 1.2;
      }
      
      /* Botones superiores */
      .filter-btn {
          transition: transform 0.2s;
      }
      .filter-btn:hover {
          transform: scale(1.05);
      }
  </style>

</head>

<body class="bg-white font-sans h-screen overflow-hidden flex">

    <!-- BARRA LATERAL IZQUIERDA (Consistente con inicio_wotoch) -->
    <aside class="w-24 flex flex-col items-center py-8 border-r border-gray-200 bg-white z-20 h-full flex-shrink-0">
      <!-- Logo Wotoch -->
       <a href="feed.html" class="hover:scale-110 transition mb-4">
        <img src="/imagenes/logo2.png" alt="Logo Wotoch" class="w-20 h-18">
      </a>

      <div class="flex flex-col space-y-8 w-full items-center">
          <!-- Icono 1 - Crear publicación -->
      <a href="hacer_publicacion.html" class="group flex flex-col items-center space-y-1 text-black hover:scale-110 transition">
        <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <rect x="2.8" y="2.8" width="18" height="18" rx="4" stroke-width="1"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg>
        <span class="text-xs hidden sm:block"></span>
      </a>
          
      <!-- Icono 2 - Corazón -->
      <a href="deseas_donar.html" class="group flex flex-col items-center space-y-1 text-black hover:scale-110 transition">
        <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <!-- Círculo exterior -->
          <circle cx="12" cy="12" r="10" stroke-width="1"/>
          <!-- Corazón centrado y reducido -->
          <path 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="1" 
            d="M12 9c-0.5-1-1.5-1.7-2.7-1.7-1.5 0-2.8 1.2-2.8 2.7 0 4.2 5.5 7 5.5 7s5.5-2.8 5.5-7c0-1.5-1.3-2.7-2.8-2.7-1.2 0-2.2 0.7-2.7 1.7Z" 
          />
        </svg>
        <span class="text-xs hidden sm:block"></span>
      </a>

          <!-- Icono 3 - Campana -->
      <a href="notificaciones.html" class="group flex flex-col items-center space-y-1 text-black hover:scale-110 transition">
        <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
        </svg>
        <span class="text-xs hidden sm:block"></span>
      </a>
    </aside>

    <!-- Contenido principal -->
    <main class="flex-1 flex flex-col relative h-full overflow-hidden bg-white">
        
        <!-- Header (Avatar Usuario Actualizado) -->
        <div class="absolute top-6 right-8 z-20">
            <button id="profileBtn" class="w-20 h-20 rounded-full overflow-hidden border-2 border-primary-brown cursor-pointer hover:opacity-80 transition shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-brown focus:ring-offset-2">
                <img id="profileImg" src="imagenes/perfil-gaby.jpg" alt="Perfil" class="w-full h-full object-cover">
            </button>
        </div>

        <!-- Contenido Superior (Título y Botones) -->
        <div class="pt-8 px-8 pb-4 flex flex-col items-center z-10 bg-white">
            <!-- Título -->
            <div class="flex items-center gap-2 mb-6">
                <h1 class="text-2xl md:text-3xl font-bold text-hero-tittle-color">
                    Instituciones y centros de acopio
                </h1>
                <!-- Símbolo de interrogación con evento onclick -->
                <svg onclick="showHelpAlert()" class="w-6 h-6 text-hero-tittle-color cursor-pointer hover:opacity-80 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>

            <!-- Botones de Filtro -->
            <div class="flex gap-4 mb-2 w-full max-w-lg justify-center">
                <button onclick="window.location.href='instituciones_acopio_cercademi.html'" class="filter-btn bg-primary-brown text-white px-8 py-2 rounded-xl font-medium shadow-md w-1/2 opacity-70 hover:opacity-80 transition">
                    Cerca de mi
                </button>
                <button class="filter-btn bg-primary-brown text-white px-8 py-2 rounded-xl font-medium shadow-lg w-1/2 active" style="background-color: #7a4a42; box-shadow: 0 4px 12px rgba(122, 74, 66, 0.4);">
                    Todas
                </button>
            </div>
        </div>

        <!-- Contenedor del Mapa -->
        <div class="flex-1 px-4 pb-4 md:px-8 md:pb-8 relative">
            <div class="w-full h-full relative rounded-2xl overflow-hidden shadow-inner border border-gray-200">
                <div id="map"></div>
            </div>
        </div>

    </main>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        // Función para mostrar la alerta de ayuda
        function showHelpAlert() {
            // Creamos un modal personalizado en lugar de usar alert() nativo para mejor estética
            const helpMessage = "Aquí puedes consultar los sitios disponibles para donar de acuerdo a la categoría que seleccionaste. Puedes filtrarlos por cuáles te quedan más cerca de todos los que tenemos registrados al rededor de la ciudad. Si donas, no olvides compartirlo e inspirar a los demás con una publicación.";
            
            // Verificar si ya existe el modal para no duplicarlo
            let existingModal = document.getElementById('help-modal');
            if (existingModal) {
                existingModal.classList.remove('hidden');
                return;
            }

            // Crear el modal
            const modal = document.createElement('div');
            modal.id = 'help-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 transition-opacity duration-300';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform scale-100 transition-transform duration-300">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold text-hero-tittle-color flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            Ayuda
                        </h3>
                        <button onclick="document.getElementById('help-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    <p class="text-gray-700 text-sm leading-relaxed mb-6">
                        ${helpMessage}
                    </p>
                    <button onclick="document.getElementById('help-modal').classList.add('hidden')" class="w-full bg-primary-brown text-white py-2.5 rounded-xl font-medium hover:bg-opacity-90 transition">
                        Entendido
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Cerrar al hacer click fuera
            modal.addEventListener('click', (e) => {
                if(e.target === modal) modal.classList.add('hidden');
            });
        }

        // 1. Inicializar el mapa centrado en CDMX (Coordenadas aproximadas de la Roma/Condesa)
        // Zoom 14 para ver calles
        var map = L.map('map').setView([19.415, -99.155], 14);

        // 2. Agregar capa de tiles (OpenStreetMap) - Estilo limpio
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // 3. Crear icono personalizado rojo (tipo Google Maps)
        var redIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // 4. Datos de las fundaciones (Simulados basados en la imagen)
        const locations = [
            {
                name: "FundHepa",
                desc: "Durango 175, Roma Nte., Cuauhtémoc, 06700 Ciudad de México, CDMX",
                coords: [19.4195, -99.1655], // Ubicación aproximada Durango 175
                open: true // Para abrir este popup al inicio
            },
            {
                name: "Centro Médico",
                desc: "Av. Cuauhtémoc 330, Doctores",
                coords: [19.4055, -99.1550]
            },
            {
                name: "Hospital General",
                desc: "Dr. Balmis 148, Doctores",
                coords: [19.4130, -99.1520]
            },
            {
                name: "Casa de la Amistad",
                desc: "Aldama 2, Tepepan (Ref)",
                coords: [19.4200, -99.1450] // Ubicación ficticia en el mapa visible
            },
            {
                name: "Albergue Temporal",
                desc: "Calle Dr. García Diego",
                coords: [19.4100, -99.1480]
            },
            {
                name: "Banco de Alimentos",
                desc: "Colonia Algarín",
                coords: [19.4020, -99.1400]
            }
        ];

        // 5. Agregar marcadores al mapa
        locations.forEach(loc => {
            var marker = L.marker(loc.coords, {icon: redIcon}).addTo(map);
            
            // Contenido del popup
            var popupContent = `
                <div class="popup-title">${loc.name}</div>
                <div class="popup-desc">${loc.desc}</div>
            `;
            
            marker.bindPopup(popupContent);

            // Si es la fundación principal (FundHepa), abrir el popup automáticamente
            if (loc.open) {
                marker.openPopup();
            }
        });

        // Función: Animación de perfil (click en foto de perfil)
        function initProfileAnimation() {
            const profileBtn = document.getElementById('profileBtn');
            if (!profileBtn) return;
            
            profileBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                const profileImg = document.getElementById('profileImg');
                if (!profileImg) return;
                
                const rect = profileBtn.getBoundingClientRect();
                
                // Crear clon animado
                const clone = profileImg.cloneNode(true);
                clone.style.position = 'fixed';
                clone.style.left = rect.left + 'px';
                clone.style.top = rect.top + 'px';
                clone.style.width = rect.width + 'px';
                clone.style.height = rect.height + 'px';
                clone.style.borderRadius = '50%';
                clone.style.zIndex = '9999';
                clone.style.transition = 'all 1.2s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 1.2s ease-in-out';
                clone.style.boxShadow = '0 10px 40px rgba(0,0,0,0.3)';
                clone.style.border = '4px solid #A25D53';
                clone.style.opacity = '1';
                document.body.appendChild(clone);
                
                // Forzar reflow
                clone.offsetHeight;
                
                // Posición final: exactamente donde está la foto en profile.html
                const sidebarWidth = 96;
                const paddingLeft = 48;
                const finalSize = 192;
                const finalLeft = sidebarWidth + paddingLeft;
                const finalTop = 64;
                
                clone.style.left = finalLeft + 'px';
                clone.style.top = finalTop + 'px';
                clone.style.width = finalSize + 'px';
                clone.style.height = finalSize + 'px';
                clone.style.opacity = '0.3';
                
                // Navegar después de la animación
                setTimeout(function() {
                    window.location.href = 'profile.html';
                }, 1200);
            });
        }

        // Inicializar animación de perfil
        initProfileAnimation();

    </script>
</body>
</html>